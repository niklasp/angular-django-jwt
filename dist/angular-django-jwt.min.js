!function(){angular.module("angular-django-jwt",["angular-django-jwt.constants","angular-django-jwt.auth-service","angular-django-jwt.interceptor","angular-django-jwt.jwt"]),angular.module("angular-django-jwt.constants",[]).constant("AUTH_EVENTS",{loginSuccess:"auth-login-success",loginFailed:"auth-login-failed",logoutSuccess:"auth-logout-success",sessionTimeout:"auth-session-timeout",notAuthenticated:"auth-not-authenticated",notAuthorized:"auth-not-authorized"}),angular.module("angular-django-jwt.auth-service",["angular-storage"]).provider("djangoAuthService",function(){this.LOCAL_CREDENTIALS_KEY="user_credentials",this.serverUrl="";var e=this,t=null;this.$get=["$log","$http","$q","store",function(r,n,a,o){function u(t){function o(e){return e.data?(d(e.data),e.data):void 0}function u(){return a.reject("DjangoAuthService: Login Failed.")}if(""===e.serverUrl){var i='SERVER_URL must not be empty, to set, call DjangoAuthService.SERVER_URL = "your.server.url"';return r.error(i),a.reject(i)}return n.post(e.serverUrl+"auth/login/",{username:t.username,password:t.password}).then(o,u)}function i(){return g()}function s(){return t}function l(){return null===t&&(t=h().then(function(e){return e})),a.when(t)}function c(e){return angular.isArray(e)||(e=[e]),l().then(function(t){return e.indexOf(-1!==t.userRole)})}function h(){var r=a.defer();if(null!==t)r.resolve(t);else{var n=o.get(e.LOCAL_CREDENTIALS_KEY);null!==n?(t=n,r.resolve(n)):r.reject()}return r.promise}function d(r){o.set(e.LOCAL_CREDENTIALS_KEY,r),t=r}function g(){return o.remove(e.LOCAL_CREDENTIALS_KEY)}return{login:u,logout:i,isAuthenticated:l,isAuthorized:c,getUser:s}}]}),angular.module("angular-django-jwt.interceptor",["angular-django-jwt.constants"]).provider("jwtInterceptor",["AUTH_EVENTS",function(e){this.urlParam=null,this.authHeader="Authorization",this.authPrefix="Bearer ",this.tokenGetter=function(){return null},this.responseError=function(){return null};var t=this;this.$get=["$q","$injector","$rootScope",function(r,n,a){return{request:function(e){if(e.skipAuthorization)return e;if(t.urlParam){if(e.params=e.params||{},e.params[t.urlParam])return e}else if(e.headers=e.headers||{},e.headers[t.authHeader])return e;var a=r.when(n.invoke(t.tokenGetter,this,{config:e}));return a.then(function(r){return r&&(t.urlParam?e.params[t.urlParam]=r:e.headers[t.authHeader]=t.authPrefix+r),e})},responseError:function(o){return null===t.responseError()?(a.$broadcast({401:e.notAuthorized,403:e.notAuthenticated}[o.status],o),r.reject(o)):n.invoke(t.responseError,this,{response:o})}}}]}]),angular.module("angular-django-jwt.jwt",[]).service("jwtHelper",["$window",function(e){this.urlBase64Decode=function(t){var r=t.replace(/-/g,"+").replace(/_/g,"/");switch(r.length%4){case 0:break;case 2:r+="==";break;case 3:r+="=";break;default:throw"Illegal base64url string!"}return e.decodeURIComponent(escape(e.atob(r)))},this.decodeToken=function(e){var t=e.split(".");if(3!==t.length)throw new Error("JWT must have 3 parts");var r=this.urlBase64Decode(t[1]);if(!r)throw new Error("Cannot decode the token");return angular.fromJson(r)},this.getTokenExpirationDate=function(e){var t=this.decodeToken(e);if("undefined"==typeof t.exp)return null;var r=new Date(0);return r.setUTCSeconds(t.exp),r},this.isTokenExpired=function(e,t){var r=this.getTokenExpirationDate(e);return t=t||0,null===r?!1:!(r.valueOf()>(new Date).valueOf()+1e3*t)}}])}();