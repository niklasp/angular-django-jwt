!function(){angular.module("angular-django-jwt",["angular-django-jwt.constants","angular-django-jwt.interceptor","angular-django-jwt.jwt","angular-django-jwt.auth-service"]),angular.module("angular-django-jwt.constants",[]).constant("AUTH_EVENTS",{loginSuccess:"auth-login-success",loginFailed:"auth-login-failed",logoutSuccess:"auth-logout-success",sessionTimeout:"auth-session-timeout",notAuthenticated:"auth-not-authenticated",notAuthorized:"auth-not-authorized"}),angular.module("angular-django-jwt.auth-service",["angular-storage","$http","$q"]).service("DjangoAuthService",["$log","$http","$q","store",function(e,t,r,n){function a(r){function n(e){return e.data?(c(e.data),e.data):void 0}function a(){return"DjangoAuthService: Login Failed."}return""===g.SERVER_URL&&e.error('SERVER_URL must not be empty, to set, call DjangoAuthService.SERVER_URL = "your.server.url"'),t.post(g.SERVER_URL+"auth/login/",{username:r.username,password:r.password}).then(n,a)}function o(){return h()}function u(){return d}function i(){return null===d&&(d=l().then(function(e){return e})),r.when(d)}function s(e){return angular.isArray(e)||(e=[e]),i().then(function(t){return e.indexOf(-1!==t.userRole)})}function l(){var e=r.defer();if(null!==d)e.resolve(d);else{var t=n.get(g.LOCAL_CREDENTIALS_KEY);null!==t?(d=t,e.resolve(t)):e.reject()}return e.promise}function c(e){n.set(g.LOCAL_CREDENTIALS_KEY,e),d=e}function h(){return n.remove(g.LOCAL_CREDENTIALS_KEY)}this.LOCAL_CREDENTIALS_KEY="user_credentials",this.SERVER_URL="";var d=null,g=this;return{login:a,logout:o,isAuthenticated:i,isAuthorized:s,getUser:u}}]),angular.module("angular-django-jwt.interceptor",["angular-django-jwt.constants"]).provider("jwtInterceptor",["AUTH_EVENTS",function(e){this.urlParam=null,this.authHeader="Authorization",this.authPrefix="Bearer ",this.tokenGetter=function(){return null},this.responseError=function(t){return $rootScope.$broadcast({401:e.notAuthorized,403:e.notAuthenticated}[t.status],t),$q.reject(t)};var t=this;this.$get=["$q","$injector","$rootScope",function(e,r){return{request:function(n){if(n.skipAuthorization)return n;if(t.urlParam){if(n.params=n.params||{},n.params[t.urlParam])return n}else if(n.headers=n.headers||{},n.headers[t.authHeader])return n;var a=e.when(r.invoke(t.tokenGetter,this,{config:n}));return a.then(function(e){return e&&(t.urlParam?n.params[t.urlParam]=e:n.headers[t.authHeader]=t.authPrefix+e),n})},responseError:this.responseError}}]}]),angular.module("angular-django-jwt.jwt",[]).service("jwtHelper",["$window",function(e){this.urlBase64Decode=function(t){var r=t.replace(/-/g,"+").replace(/_/g,"/");switch(r.length%4){case 0:break;case 2:r+="==";break;case 3:r+="=";break;default:throw"Illegal base64url string!"}return e.decodeURIComponent(escape(e.atob(r)))},this.decodeToken=function(e){var t=e.split(".");if(3!==t.length)throw new Error("JWT must have 3 parts");var r=this.urlBase64Decode(t[1]);if(!r)throw new Error("Cannot decode the token");return angular.fromJson(r)},this.getTokenExpirationDate=function(e){var t=this.decodeToken(e);if("undefined"==typeof t.exp)return null;var r=new Date(0);return r.setUTCSeconds(t.exp),r},this.isTokenExpired=function(e,t){var r=this.getTokenExpirationDate(e);return t=t||0,null===r?!1:!(r.valueOf()>(new Date).valueOf()+1e3*t)}}])}();